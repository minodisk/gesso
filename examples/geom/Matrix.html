<!DOCTYPE html>
<html>
<head>
  <title>graphicsJS Examples | Matrix</title>
  <link rel="stylesheet" href="../../resources/paige.css"/>
  <link rel="stylesheet" href="../resources/example.css"/>
  <script src="../../lib/graphics.js"></script>
  <script src="../resources/execute.js"></script>
</head>
<body>

<header>
  <a href="../">index</a>

  <h1>Matrix</h1>
</header>

<section>
  <h2>Transform</h2>
  <div class="execute">
    <canvas width="500" height="500"></canvas>
<pre>
var stage = new Stage(canvas);
var loader = new Loader();
loader.load('../resources/lena_256.png');
loader.addEventListener(Event.COMPLETE, onLoadComplete);
stage.addChild(loader);

var width, height, origin, anchorX, anchorY;

function onLoadComplete(e) {
  width = loader.width;
  height = loader.height;

  origin = new Sprite();
  origin.buttonMode = true;
  origin.graphics.beginFill(0x0581d2);
  origin.graphics.drawCircle(0, 0, 5);
  origin.graphics.endFill();
  origin.x = (stage.width - width) / 2;
  origin.y = (stage.height - height) / 2;
  stage.addChild(origin);

  anchorX = new Sprite();
  anchorX.buttonMode = true;
  anchorX.graphics.beginFill(0x0581d2);
  anchorX.graphics.drawCircle(0, 0, 5);
  anchorX.graphics.endFill();
  anchorX.x = origin.x + width;
  anchorX.y = origin.y;
  stage.addChild(anchorX);

  anchorY = new Sprite();
  anchorY.buttonMode = true;
  anchorY.graphics.beginFill(0x0581d2);
  anchorY.graphics.drawCircle(0, 0, 5);
  anchorY.graphics.endFill();
  anchorY.x = origin.x;
  anchorY.y = origin.y + height;
  stage.addChild(anchorY);

  onMouseMove();
  origin.addEventListener(MouseEvent.MOUSE_DOWN, onMouseDown);
  anchorX.addEventListener(MouseEvent.MOUSE_DOWN, onMouseDown);
  anchorY.addEventListener(MouseEvent.MOUSE_DOWN, onMouseDown);
}

function onMouseDown(e) {
  anchor = e.currentTarget;
  anchor.startDrag();
  stage.addEventListener(MouseEvent.MOUSE_MOVE, onMouseMove);
  stage.addEventListener(MouseEvent.MOUSE_UP, onMouseUp);
}

function onMouseMove(e) {
  var ptO = new Point(origin.x, origin.y);
  var ptX = new Point(anchorX.x, anchorX.y);
  var ptY = new Point(anchorY.x, anchorY.y);
  var scaleX = ptX.distanceFrom(ptO) / width;
  var scaleY = ptY.distanceFrom(ptO) / height;
  ptX.subtract(ptO).normalize(scaleX);
  ptY.subtract(ptO).normalize(scaleY);
  loader.matrix = new Matrix(ptX.x, ptX.y, ptY.x, ptY.y, ptO.x, ptO.y);
}
function onMouseUp(e) {
  stage.removeEventListener(MouseEvent.MOUSE_MOVE, onMouseMove);
  stage.removeEventListener(MouseEvent.MOUSE_UP, onMouseUp);
  anchor.stopDrag();
}
</pre>
  </div>
</section>

</body>
</html>